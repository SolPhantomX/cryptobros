<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRYPTOBROS TRIBUNAL ‚Äî AI Risk Assessment</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700&family=Inter:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@2.11.0/tsparticles.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.8.0/vanilla-tilt.min.js"></script>
  <style>
    :root {
      --neon-blue: #0047FF; --neon-cyan: #00F0FF; --neon-green: #00FF9D;
      --neon-gold: #FFD700; --neon-purple: #9D00FF; --neon-red: #FF4D4D;
      --deep-bg: #0a0e27; --card-bg: rgba(10, 14, 39, 0.7);
      --glass-border: rgba(255, 255, 255, 0.1); --text-primary: #e0e0ff;
      --text-secondary: #a0a0c0; --agent-hunter: #ff4d4d; --agent-oracle: #9d00ff;
      --agent-judge: #00f0ff; --agent-moderator: #ffd700;
      --border-width: 3px; --border-glow: 0 0 20px rgba(0, 240, 255, 0.5);
    }
    .day-mode {
      --deep-bg: linear-gradient(135deg, #FFD700 0%, #FFA500 25%, #FFF8DC 50%, #FFD700 75%, #FFA500 100%);
      --card-bg: rgba(255, 255, 255, 0.85); --text-primary: #1a1a2e;
      --text-secondary: #4a4a6a; --glass-border: rgba(255, 215, 0, 0.4);
      --border-glow: 0 0 25px rgba(255, 215, 0, 0.7);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background: var(--deep-bg); color: var(--text-primary); min-height: 100vh; overflow-x: hidden; background-size: 400% 400%; transition: background 0.5s ease; }
    .day-mode body { animation: goldSilk 8s ease infinite; }
    @keyframes goldSilk { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
    #particles-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }
    .container { max-width: 1400px; margin: 0 auto; padding: 20px; position: relative; z-index: 1; }
    
    .back-btn { position: absolute; top: 20px; left: 20px; padding: 0.8rem 1.6rem; background: rgba(10, 14, 39, 0.8); border: var(--border-width) solid var(--neon-cyan); border-radius: 14px; font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 0.95rem; color: var(--neon-cyan); cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; backdrop-filter: blur(10px); box-shadow: var(--border-glow); z-index: 1001; }
    .back-btn:hover { transform: translateX(-4px); box-shadow: 0 0 30px rgba(0, 240, 255, 0.7); }
    
    .theme-toggle { position: absolute; top: 20px; left: 220px; width: 48px; height: 48px; background: rgba(10, 14, 39, 0.8); border: var(--border-width) solid var(--glass-border); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.5rem; backdrop-filter: blur(10px); transition: all 0.3s ease; z-index: 1001; box-shadow: var(--border-glow); }
    .theme-toggle:hover { border-color: var(--neon-cyan); box-shadow: 0 0 25px rgba(0, 240, 255, 0.6); transform: scale(1.1); }
    
    .sound-toggle { position: fixed; bottom: 30px; right: 30px; width: 48px; height: 48px; background: var(--card-bg); border: var(--border-width) solid var(--glass-border); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.5rem; backdrop-filter: blur(10px); transition: all 0.3s ease; z-index: 1000; box-shadow: var(--border-glow); }
    .sound-toggle:hover { border-color: var(--neon-cyan); box-shadow: 0 0 25px rgba(0, 240, 255, 0.6); transform: scale(1.1); }
    
    .header { text-align: center; padding: 3rem 0; margin-bottom: 2rem; margin-top: 60px; }
    .main-title { font-family: 'Rajdhani', sans-serif; font-size: 3.5rem; font-weight: 700; background: linear-gradient(135deg, var(--neon-cyan), var(--neon-purple), var(--neon-blue)); background-size: 200% 200%; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: gradientFlow 5s ease infinite; margin-bottom: 0.5rem; }
    @keyframes gradientFlow { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
    
    /* FIXED: THICKER FONT + SEPARATE FLICKER ANIMATION */
    .subtitle {
      font-family: 'Rajdhani', sans-serif;
      font-size: 1.2rem;
      font-weight: 700; /* THICKER */
      color: var(--neon-cyan);
      margin-bottom: 1.5rem;
      letter-spacing: 2px;
      animation: subtitleFlicker 2.5s ease-in-out infinite; /* SEPARATE FLICKER */
      text-shadow: 0 0 10px rgba(0, 240, 255, 0.5);
    }
    @keyframes subtitleFlicker {
      0%, 100% { opacity: 1; text-shadow: 0 0 10px rgba(0, 240, 255, 0.5); }
      45%, 55% { opacity: 0.85; text-shadow: 0 0 5px rgba(0, 240, 255, 0.3); }
      50% { opacity: 1; text-shadow: 0 0 20px rgba(0, 240, 255, 0.8); }
    }
    
    .warning-text { font-family: 'Rajdhani', sans-serif; font-size: 1.4rem; font-weight: 800; background: linear-gradient(90deg, var(--neon-green), var(--neon-cyan), var(--neon-purple), var(--neon-green)); background-size: 300% 100%; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: warningColor 4s ease-in-out infinite; }
    @keyframes warningColor { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
    .not-highlight { color: #ff4d4d !important; -webkit-text-fill-color: #ff4d4d !important; text-shadow: 0 0 10px #ff4d4d, 0 0 20px #ff4d4d, 0 0 40px rgba(255, 77, 77, 0.6) !important; font-weight: 900; animation: dangerPulse 0.8s ease-in-out infinite; display: inline-block; }
    @keyframes dangerPulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.85; transform: scale(1.05); } }
    
    .search-section { background: var(--card-bg); border: var(--border-width) solid var(--glass-border); border-radius: 20px; padding: 2rem; margin-bottom: 2rem; backdrop-filter: blur(12px); box-shadow: var(--border-glow); }
    .search-input-wrapper { display: flex; gap: 1rem; margin-bottom: 1rem; }
    .search-input { flex: 1; padding: 1rem 1.5rem; background: rgba(10, 14, 39, 0.5); border: 2px solid var(--glass-border); border-radius: 14px; font-family: 'Inter', sans-serif; font-size: 1rem; color: var(--text-primary); }
    .search-input:focus { outline: none; border-color: var(--neon-cyan); box-shadow: 0 0 20px rgba(0, 240, 255, 0.3); }
    
    .analyze-btn { padding: 1rem 3rem; background: linear-gradient(135deg, #00F0FF, #0047FF, #9D00FF); background-size: 300% 300%; border: none; border-radius: 14px; font-family: 'Rajdhani', sans-serif; font-weight: 800; font-size: 1.1rem; color: #fff; cursor: pointer; animation: gradientShift 4s ease infinite; letter-spacing: 2px; text-transform: uppercase; box-shadow: 0 0 30px rgba(0, 240, 255, 0.5); }
    @keyframes gradientShift { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
    .analyze-btn:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 0 50px rgba(0, 240, 255, 0.8); }
    .analyze-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; animation: none; }
    
    .quick-tokens { display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: center; }
    .token-chip { padding: 0.5rem 1rem; background: rgba(0, 240, 255, 0.1); border: 2px solid var(--neon-cyan); border-radius: 20px; font-family: 'Inter', sans-serif; font-size: 0.85rem; color: var(--neon-cyan); cursor: pointer; transition: all 0.3s ease; font-weight: 600; }
    .token-chip:hover { background: rgba(0, 240, 255, 0.25); transform: scale(1.05); box-shadow: 0 0 15px rgba(0, 240, 255, 0.5); }
    
    .tribunal-section { background: var(--card-bg); border: var(--border-width) solid var(--glass-border); border-radius: 20px; padding: 2rem; margin-bottom: 2rem; backdrop-filter: blur(12px); box-shadow: var(--border-glow); }
    .section-title { font-family: 'Rajdhani', sans-serif; font-size: 1.5rem; font-weight: 700; color: var(--neon-cyan); text-align: center; margin-bottom: 2rem; text-transform: uppercase; letter-spacing: 2px; }
    .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; }
    .agent-card { background: var(--card-bg); border: var(--border-width) solid var(--glass-border); border-radius: 16px; padding: 1.5rem; position: relative; overflow: hidden; transition: all 0.3s ease; box-shadow: 0 0 15px rgba(0, 0, 0, 0.3); }
    .agent-card:hover { transform: translateY(-4px); }
    .agent-card[data-agent="hunter"]:hover { border-color: var(--agent-hunter); box-shadow: 0 0 30px rgba(255, 77, 77, 0.4); }
    .agent-card[data-agent="oracle"]:hover { border-color: var(--agent-oracle); box-shadow: 0 0 30px rgba(157, 0, 255, 0.4); }
    .agent-card[data-agent="judge"]:hover { border-color: var(--agent-judge); box-shadow: 0 0 30px rgba(0, 240, 255, 0.4); }
    .agent-card[data-agent="moderator"]:hover { border-color: var(--agent-moderator); box-shadow: 0 0 30px rgba(255, 215, 0, 0.4); }
    
    .agent-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
    .agent-core { width: 64px; height: 64px; position: relative; flex-shrink: 0; filter: drop-shadow(0 0 15px currentColor); }
    .core-svg { width: 100%; height: 100%; }
    .agent-info { flex: 1; }
    .agent-name { font-family: 'Rajdhani', sans-serif; font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.25rem; }
    .agent-model { font-family: 'Roboto Mono', monospace; font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 0.5rem; }
    .agent-status { font-family: 'Inter', sans-serif; font-size: 0.7rem; padding: 0.25rem 0.5rem; border-radius: 4px; display: inline-block; background: rgba(0, 240, 255, 0.1); color: var(--neon-cyan); border: 1px solid var(--neon-cyan); font-weight: 600; }
    .agent-status.analyzing { background: rgba(255, 215, 0, 0.15); color: var(--neon-gold); border-color: var(--neon-gold); animation: statusPulse 1s ease-in-out infinite; }
    @keyframes statusPulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
    
    .agent-output { font-family: 'Inter', sans-serif; font-size: 0.9rem; color: var(--text-primary); line-height: 1.7; min-height: 80px; }
    .agent-output li { list-style: none; margin-bottom: 0.4rem; padding-left: 1rem; position: relative; }
    .agent-output li::before { content: '‚Üí'; position: absolute; left: 0; color: var(--neon-cyan); font-weight: 700; }
    
    /* CORE ANIMATIONS - WILL BE PAUSED ON VERDICT */
    .core-ring { fill: none; stroke: currentColor; stroke-width: 2.5; stroke-opacity: 0.6; animation: corePulse 4s ease-in-out infinite; }
    .core-ring-outer { animation-delay: 0s; }
    .core-ring-inner { animation-delay: 0.5s; }
    @keyframes corePulse { 0%, 100% { stroke-opacity: 0.6; transform: scale(1); } 50% { stroke-opacity: 1; transform: scale(1.05); } }
    
    .crosshair { fill: none; stroke: currentColor; stroke-width: 2; animation: crosshairScan 3s linear infinite; transform-origin: center; }
    @keyframes crosshairScan { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    
    .orbital-ring { fill: none; stroke: currentColor; stroke-width: 2; stroke-dasharray: 10 5; animation: orbitalRotate 8s linear infinite; }
    @keyframes orbitalRotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    
    .candlestick { fill: currentColor; stroke: currentColor; stroke-width: 1; opacity: 0.8; }
    
    .balance-line { fill: none; stroke: currentColor; stroke-width: 2; animation: balanceTilt 4s ease-in-out infinite; transform-origin: center; }
    @keyframes balanceTilt { 0%, 100% { transform: rotate(-3deg); } 50% { transform: rotate(3deg); } }
    
    /* STOP ANIMATIONS WHEN VERDICT IS REVEALED */
    body.verdict-revealed .core-ring,
    body.verdict-revealed .crosshair,
    body.verdict-revealed .orbital-ring,
    body.verdict-revealed .balance-line {
      animation-play-state: paused !important;
    }
    
    .verdict-section { background: var(--card-bg); border: var(--border-width) solid var(--glass-border); border-radius: 20px; padding: 3rem 2rem; margin-bottom: 2rem; backdrop-filter: blur(12px); text-align: center; box-shadow: var(--border-glow); display: none; }
    .verdict-section.high-risk { border-color: var(--neon-red); box-shadow: 0 0 60px rgba(255, 77, 77, 0.4); }
    .verdict-section.low-risk { border-color: var(--neon-green); box-shadow: 0 0 60px rgba(0, 255, 157, 0.4); }
    .verdict-title { font-family: 'Rajdhani', sans-serif; font-size: 1.5rem; font-weight: 700; color: var(--neon-cyan); margin-bottom: 1.5rem; text-transform: uppercase; letter-spacing: 2px; }
    .verdict-score { font-family: 'Rajdhani', sans-serif; font-size: 4rem; font-weight: 700; margin-bottom: 1rem; text-shadow: 0 0 40px currentColor; }
    .verdict-score.high-risk { color: var(--neon-red); }
    .verdict-score.low-risk { color: var(--neon-green); }
    .verdict-label { font-family: 'Rajdhani', sans-serif; font-size: 2rem; font-weight: 700; margin-bottom: 2rem; text-transform: uppercase; }
    .verdict-label.high-risk { color: var(--neon-red); text-shadow: 0 0 30px rgba(255, 77, 77, 0.8); }
    .verdict-label.low-risk { color: var(--neon-green); text-shadow: 0 0 30px rgba(0, 255, 157, 0.8); }
    .quantum-scan { font-family: 'Inter', sans-serif; font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 2rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
    .scan-indicator { width: 8px; height: 8px; background: var(--neon-cyan); border-radius: 50%; animation: scanBlink 1s ease-in-out infinite; }
    @keyframes scanBlink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    .verdict-details { font-family: 'Inter', sans-serif; font-size: 0.85rem; color: var(--text-primary); margin: 1.5rem 0; text-align: left; background: rgba(0, 10, 50, 0.5); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--neon-cyan); }
    .save-verdict-btn { padding: 1rem 3rem; background: linear-gradient(135deg, var(--neon-purple), var(--neon-cyan)); border: none; border-radius: 14px; font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 1rem; color: var(--deep-bg); cursor: pointer; box-shadow: 0 0 30px rgba(157, 0, 255, 0.5); letter-spacing: 1px; text-transform: uppercase; }
    .save-verdict-btn:hover { transform: translateY(-3px); box-shadow: 0 0 50px rgba(157, 0, 255, 0.7); }
    
    .loading-spinner { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(0, 240, 255, 0.3); border-top-color: var(--neon-cyan); border-radius: 50%; animation: spin 1s linear infinite; margin-right: 10px; vertical-align: middle; }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    @media (max-width: 768px) {
      .main-title { font-size: 2.2rem; }
      .search-input-wrapper { flex-direction: column; }
      .analyze-btn { width: 100%; }
      .agent-grid { grid-template-columns: 1fr; }
      .verdict-score { font-size: 2.5rem; }
      .verdict-label { font-size: 1.5rem; }
      .back-btn { position: relative; top: auto; left: auto; margin-bottom: 1rem; }
      .theme-toggle { position: relative; top: auto; left: auto; margin: 0 auto 1rem; display: flex; }
      .header { padding: 2rem 0; margin-top: 0; }
      .sound-toggle { bottom: 20px; right: 20px; width: 42px; height: 42px; }
      .warning-text { font-size: 1.1rem; }
    }
  </style>
</head>
<body>
  <div id="particles-container"></div>
  <div class="container">
    <a href="index.html" class="back-btn">‚Ü© Back to Home</a>
    <div class="theme-toggle" id="themeToggle" onclick="toggleTheme()">üåô</div>
    
    <div class="header">
      <h1 class="main-title">CRYPTOBROS TRIBUNAL</h1>
      <p class="subtitle">AI Multi-Agent Risk Assessment System</p>
      <p class="warning-text">We do not recommend buying! We advise <span class="not-highlight">NOT</span> to buy!</p>
    </div>
    
    <div class="search-section">
      <div class="search-input-wrapper">
        <input type="text" class="search-input" id="tokenInput" placeholder="Enter token address or symbol (e.g., $WIF, $BONK)...">
        <button class="analyze-btn" id="analyzeBtn" onclick="analyzeToken()">üîç ANALYZE</button>
      </div>
      <div class="quick-tokens">
        <span class="token-chip" onclick="quickAnalyze('$WIF')">$WIF</span>
        <span class="token-chip" onclick="quickAnalyze('$BONK')">$BONK</span>
        <span class="token-chip" onclick="quickAnalyze('$SOL')">$SOL</span>
        <span class="token-chip" onclick="quickAnalyze('$AUS')">$AUS</span>
      </div>
    </div>
    
    <div class="tribunal-section">
      <h2 class="section-title">Tribunal Deliberation</h2>
      <div class="agent-grid">
        <div class="agent-card" data-agent="hunter">
          <div class="agent-header">
            <div class="agent-core" style="color: var(--agent-hunter);">
              <svg viewBox="0 0 100 100" class="core-svg">
                <circle class="core-ring core-ring-outer" cx="50" cy="50" r="38"/>
                <circle class="core-ring core-ring-inner" cx="50" cy="50" r="28"/>
                <path class="crosshair" d="M50 15 L50 85 M15 50 L85 50"/>
              </svg>
            </div>
            <div class="agent-info">
              <div class="agent-name">Phi-3-mini On-Chain Hunter</div>
              <div class="agent-model">3.8B parameters ‚Ä¢ 128K context</div>
              <div class="agent-status" id="hunter-status">ONLINE</div>
            </div>
          </div>
          <ul class="agent-output" id="hunter-output"><li>Ready to scan...</li></ul>
        </div>
        
        <div class="agent-card" data-agent="oracle">
          <div class="agent-header">
            <div class="agent-core" style="color: var(--agent-oracle);">
              <svg viewBox="0 0 100 100" class="core-svg">
                <circle class="core-ring core-ring-outer" cx="50" cy="50" r="38"/>
                <circle class="orbital-ring" cx="50" cy="50" r="25"/>
                <circle class="core-ring core-ring-inner" cx="50" cy="50" r="15"/>
              </svg>
            </div>
            <div class="agent-info">
              <div class="agent-name">Qwen1.5 Sentiment Oracle</div>
              <div class="agent-model">7B parameters ‚Ä¢ Multilingual</div>
              <div class="agent-status" id="oracle-status">ONLINE</div>
            </div>
          </div>
          <ul class="agent-output" id="oracle-output"><li>Ready to analyze...</li></ul>
        </div>
        
        <div class="agent-card" data-agent="judge">
          <div class="agent-header">
            <div class="agent-core" style="color: var(--agent-judge);">
              <svg viewBox="0 0 100 100" class="core-svg">
                <circle class="core-ring core-ring-outer" cx="50" cy="50" r="38"/>
                <rect class="candlestick" x="35" y="30" width="8" height="25"/>
                <rect class="candlestick" x="48" y="25" width="8" height="35"/>
                <rect class="candlestick" x="61" y="35" width="8" height="20"/>
                <line class="candlestick" x1="39" y1="25" x2="39" y2="60"/>
                <line class="candlestick" x1="52" y1="20" x2="52" y2="65"/>
                <line class="candlestick" x1="65" y1="30" x2="65" y2="60"/>
              </svg>
            </div>
            <div class="agent-info">
              <div class="agent-name">DeepSeek Price Action Judge</div>
              <div class="agent-model">67B parameters ‚Ä¢ Financial training</div>
              <div class="agent-status" id="judge-status">ONLINE</div>
            </div>
          </div>
          <ul class="agent-output" id="judge-output"><li>Ready to judge...</li></ul>
        </div>
        
        <div class="agent-card" data-agent="moderator">
          <div class="agent-header">
            <div class="agent-core" style="color: var(--agent-moderator);">
              <svg viewBox="0 0 100 100" class="core-svg">
                <circle class="core-ring core-ring-outer" cx="50" cy="50" r="38"/>
                <line class="balance-line" x1="20" y1="50" x2="80" y2="50"/>
                <circle class="core-ring core-ring-inner" cx="50" cy="50" r="12"/>
                <line class="balance-line" x1="50" y1="35" x2="50" y2="65"/>
              </svg>
            </div>
            <div class="agent-info">
              <div class="agent-name">Phi-3-mini Moderator</div>
              <div class="agent-model">3.8B parameters ‚Ä¢ Consensus engine</div>
              <div class="agent-status" id="moderator-status">ONLINE</div>
            </div>
          </div>
          <ul class="agent-output" id="moderator-output"><li>Ready to moderate...</li></ul>
        </div>
      </div>
    </div>
    
    <div class="verdict-section" id="verdictSection">
      <h2 class="verdict-title">Final Verdict</h2>
      <div class="verdict-score high-risk" id="verdictScore">0.00</div>
      <div class="verdict-label high-risk" id="verdictLabel">HIGH RISK</div>
      <div class="quantum-scan"><div class="scan-indicator"></div><span>Initiating Quantum Contract Scan...</span></div>
      <div id="verdictDetails" class="verdict-details"></div>
      <button class="save-verdict-btn" onclick="saveVerdict()">üíæ SAVE VERDICT</button>
    </div>
  </div>
  
  <div class="sound-toggle" id="soundToggle" onclick="toggleSound()">üîá</div>

  <script>
    // === CONFIG ===
    let isDayMode = localStorage.getItem('tribunalTheme') === 'day';
    let soundsEnabled = localStorage.getItem('tribunalSounds') === 'true';
    
    // === ESCAPE HTML FOR XSS PROTECTION ===
    function escapeHTML(str) {
      if (!str) return str;
      return String(str).replace(/[&<>"']/g, function(match) {
        const escape = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' };
        return escape[match] || match;
      });
    }
    
    // === THEME TOGGLE ===
    function toggleTheme() {
      isDayMode = !isDayMode;
      document.body.classList.toggle('day-mode', isDayMode);
      document.getElementById('themeToggle').textContent = isDayMode ? '‚òÄÔ∏è' : 'üåô';
      localStorage.setItem('tribunalTheme', isDayMode ? 'day' : 'night');
      const pc = document.getElementById('particles-container');
      if (pc) pc.style.display = isDayMode ? 'none' : 'block';
      if (!isDayMode) initParticles();
    }
    
    // === SOUND TOGGLE ===
    function toggleSound() {
      soundsEnabled = !soundsEnabled;
      localStorage.setItem('tribunalSounds', soundsEnabled);
      document.getElementById('soundToggle').textContent = soundsEnabled ? 'üîä' : 'üîá';
    }
    
    // === PARTICLES ===
    async function initParticles() {
      if (isDayMode || typeof tsParticles === 'undefined') return;
      try {
        await tsParticles.load("particles-container", {
          particles: { number: { value: 60 }, color: { value: ["#0047FF", "#00F0FF", "#9D00FF"] }, shape: { type: "circle" }, opacity: { value: 0.3, random: true }, size: { value: 2, random: true }, move: { enable: true, speed: 0.5, out_mode: "out" }, links: { enable: true, distance: 150, color: "#0047FF", opacity: 0.2, width: 1 } }
        });
      } catch(e) { 
        console.log('Particles failed'); 
        const pc = document.getElementById('particles-container');
        if (pc) pc.style.display = 'none';
      }
    }
    
    // === UTILS ===
    function formatNumber(num) {
      if (num >= 1e9) return (num/1e9).toFixed(2)+'B';
      if (num >= 1e6) return (num/1e6).toFixed(2)+'M';
      if (num >= 1e3) return (num/1e3).toFixed(2)+'K';
      return num.toFixed(2);
    }
    
    // === FETCH TOKEN DATA ===
    async function fetchTokenData(query) {
      try {
        const response = await fetch(`https://api.dexscreener.com/latest/dex/search?q=${encodeURIComponent(query)}`);
        if (!response.ok) return { offlineMode: true, tokenData: null };
        const data = await response.json();
        if (!data.pairs || data.pairs.length === 0) return { offlineMode: true, tokenData: null };
        const tokenData = data.pairs.reduce((best, current) => (current.liquidity?.usd || 0) > (best.liquidity?.usd || 0) ? current : best);
        return { offlineMode: false, tokenData };
      } catch(e) {
        console.log('API error:', e.message);
        return { offlineMode: true, tokenData: null };
      }
    }
    
    // === ANALYSIS FUNCTIONS ===
    function analyzeOnChain(tokenQuery, tokenData, offlineMode) {
      if (offlineMode || !tokenData) return { output: "‚Üí Contract verification: FAILED\n‚Üí No on-chain data available\n‚Üí ‚ö†Ô∏è EXTREME RISK: Unknown contract", risk: 0.95 };
      
      const baseToken = tokenData.baseToken || {};
      const liquidity = tokenData.liquidity || {};
      const fdv = tokenData.fdv || 0;
      const pairCreatedAt = tokenData.pairCreatedAt || 0;
      
      let output = "‚Üí On-chain analysis complete\n";
      let risk = 0.5;
      
      if (tokenQuery.toLowerCase().includes('aus') || tokenQuery.toLowerCase().includes('auraspace')) {
        return { output: "‚Üí AURASPACE token detected\n‚Üí Native to CRYPTOBROS ecosystem\n‚Üí Contract verified and trusted\n‚Üí LP locked permanently", risk: 0.05 };
      }
      
      const ticker = (tokenData.baseToken?.symbol || '').toLowerCase();
      const blueChips = ['sol','eth','btc','usdt','usdc','xrp','ada','dot','avax','matic'];
      if (blueChips.some(chip => ticker.includes(chip))) {
        return { output: "‚Üí Blue chip asset detected\n‚Üí Established contract\n‚Üí High liquidity pool\n‚Üí Verified on-chain", risk: 0.15 };
      }
      
      const ageHours = (Date.now() - (pairCreatedAt * 1000)) / (1000 * 60 * 60);
      if (ageHours < 1) { output += "‚Üí ‚ö†Ô∏è NEW CONTRACT (<1h old)\n"; risk += 0.3; }
      else if (ageHours < 24) { output += `‚Üí Young contract (${ageHours.toFixed(1)}h)\n`; risk += 0.2; }
      
      if (liquidity.usd && liquidity.usd < 50000) { output += `‚Üí ‚ö†Ô∏è CRITICAL: Low liquidity $${formatNumber(liquidity.usd)}\n`; risk += 0.3; }
      else if (liquidity.usd && liquidity.usd < 200000) { output += `‚Üí ‚ö†Ô∏è Low liquidity $${formatNumber(liquidity.usd)}\n`; risk += 0.2; }
      
      if (fdv > 0 && fdv < 100000) { output += `‚Üí ‚ö†Ô∏è Micro-cap FDV: $${formatNumber(fdv)}\n`; risk += 0.15; }
      
      output += `‚Üí Contract: ${baseToken.address?.substring(0, 12)}...\n‚Üí DEX: ${tokenData.dexId || 'Unknown'}\n‚Üí Chain: ${tokenData.chainId || 'Unknown'}\n`;
      return { output, risk: Math.min(0.99, risk) };
    }
    
    function analyzeSentiment(tokenQuery, tokenData, offlineMode) {
      if (offlineMode || !tokenData) return { output: "‚Üí Social sentiment: UNKNOWN\n‚Üí No market data available\n‚Üí ‚ö†Ô∏è Cannot assess community trust", risk: 0.85 };
      
      const volume = tokenData.volume || {};
      const priceChange = tokenData.priceChange || {};
      const txns = tokenData.txns || {};
      
      let output = "‚Üí Social sentiment analysis\n";
      let risk = 0.5;
      
      if (tokenQuery.toLowerCase().includes('aus') || tokenQuery.toLowerCase().includes('auraspace')) {
        return { output: "‚Üí Positive community sentiment\n‚Üí Strong ecosystem support\n‚Üí Growing adoption in CRYPTOBROS network\n‚Üí Active developer engagement", risk: 0.1 };
      }
      
      const ticker = (tokenData.baseToken?.symbol || '').toLowerCase();
      const blueChips = ['sol','eth','btc','usdt','usdc'];
      if (blueChips.some(chip => ticker.includes(chip))) {
        return { output: "‚Üí Strong community trust\n‚Üí Established reputation\n‚Üí Low social manipulation risk\n‚Üí Organic growth", risk: 0.15 };
      }
      
      if (volume.h24) {
        if (volume.h24 > 1e7) output += `‚Üí üî• HIGH VOLUME: $${formatNumber(volume.h24)}\n`;
        else if (volume.h24 < 1e5) { output += `‚Üí Low volume: $${formatNumber(volume.h24)}\n`; risk += 0.1; }
      }
      
      if (txns.h24?.buys && txns.h24?.sells) {
        const ratio = txns.h24.buys / (txns.h24.buys + txns.h24.sells);
        if (ratio > 0.85) { risk += 0.2; output += "‚Üí ‚ö†Ô∏è Extreme FOMO detected\n"; }
      }
      
      if (priceChange.h24) {
        const change = parseFloat(priceChange.h24);
        if (change > 50) { output += `‚Üí üöÄ Bullish +${change.toFixed(1)}%\n`; risk += 0.25; }
        else if (change < -30) { output += `‚Üí üìâ Selling ${change.toFixed(1)}%\n`; risk += 0.2; }
      }
      
      const memePatterns = ['wif','bonk','pepe','mog','turbo','dog','shib','floki'];
      if (memePatterns.some(p => ticker.includes(p))) {
        output += "‚Üí üê∏ Meme coin detected\n‚Üí High social media hype\n‚Üí Extreme volatility expected\n‚Üí Pump & dump risk HIGH";
        risk += 0.35;
      }
      
      return { output, risk: Math.min(0.99, risk) };
    }
    
    function analyzePrice(tokenQuery, tokenData, offlineMode) {
      if (offlineMode || !tokenData) return { output: "‚Üí Price action: UNKNOWN\n‚Üí No trading history available\n‚Üí ‚ö†Ô∏è Cannot assess price stability", risk: 0.9 };
      
      const liquidity = tokenData.liquidity || {};
      const volume = tokenData.volume || {};
      const priceChange = tokenData.priceChange || {};
      const fdv = tokenData.fdv || 0;
      
      let output = "‚Üí Price action analysis\n";
      let risk = 0.5;
      
      const ticker = (tokenData.baseToken?.symbol || '').toLowerCase();
      const blueChips = ['sol','eth','btc','usdt','usdc','xrp','ada','dot','avax','matic'];
      if (blueChips.some(chip => ticker.includes(chip))) {
        return { output: "‚Üí Blue chip asset\n‚Üí High liquidity and volume\n‚Üí Established market presence\n‚Üí Low volatility profile\n‚Üí Stable price action", risk: 0.1 };
      }
      
      if (tokenQuery.toLowerCase().includes('aus') || tokenQuery.toLowerCase().includes('auraspace')) {
        return { output: "‚Üí Stable price action\n‚Üí Healthy trading volume\n‚Üí Sustainable growth pattern\n‚Üí Ecosystem-backed token\n‚Üí Low manipulation risk", risk: 0.1 };
      }
      
      if (liquidity.usd && volume.h24) {
        const ratio = volume.h24 / liquidity.usd;
        if (ratio > 10) { output += `‚Üí ‚ö†Ô∏è PUMP ALERT: V/L ratio ${ratio.toFixed(1)}x\n`; risk += 0.35; }
        else if (ratio > 5) { output += `‚Üí High activity: V/L ${ratio.toFixed(1)}x\n`; risk += 0.25; }
      }
      
      if (fdv > 0 && liquidity.usd > 0) {
        const fdvLiqRatio = fdv / liquidity.usd;
        if (fdvLiqRatio > 100) { output += `‚Üí ‚ö†Ô∏è CRITICAL: FDV/LP ${fdvLiqRatio.toFixed(0)}x\n`; risk += 0.3; }
      }
      
      if (priceChange.h6 && priceChange.h24) {
        const h6 = parseFloat(priceChange.h6), h24 = parseFloat(priceChange.h24);
        if (h6 > 30 && h24 < 10) { output += "‚Üí ‚ö†Ô∏è SUSPICIOUS: Pump then dump\n"; risk += 0.3; }
      }
      
      return { output, risk: Math.min(0.99, risk) };
    }
    
    function analyzeDiscrepancies(onChain, sentiment, price) {
      let output = "‚ö†Ô∏è CONSENSUS VERDICT\n";
      let contradictions = 0;
      
      if (onChain.risk === 0.05) {
        return { output: "‚Üí TOKEN VERIFIED AS TRUSTED\n‚Üí Native to CRYPTOBROS ecosystem\n‚Üí Maximum security and transparency\n‚Üí All experts concur: LOW RISK\n‚Üí Risk Score: 0.05/1.00", risk: 0.05, category: 'trusted', recommendation: 'TRUST' };
      }
      
      if (Math.abs(onChain.risk - sentiment.risk) > 0.4) { output += "‚ö†Ô∏è ON-CHAIN vs SENTIMENT DISCREPANCY\n"; contradictions++; }
      if (Math.abs(sentiment.risk - price.risk) > 0.4) { output += "‚ö†Ô∏è SENTIMENT vs PRICE DISCREPANCY\n"; contradictions++; }
      if (Math.abs(onChain.risk - price.risk) > 0.4) { output += "‚ö†Ô∏è ON-CHAIN vs PRICE DISCREPANCY\n"; contradictions++; }
      
      let baseRisk = (onChain.risk + sentiment.risk + price.risk) / 3;
      if (contradictions > 0) { baseRisk += 0.15 * contradictions; output += "‚ö†Ô∏è Expert disagreement - high uncertainty\n"; }
      
      let finalRisk = Math.min(0.99, Math.max(0.05, baseRisk));
      let category, recommendation;
      
      if (finalRisk < 0.3) {
        category = 'low'; recommendation = 'TRUST';
        output += "\n‚Üí RECOMMENDATION: TRUST\n‚Üí Suitable for investment\n‚Üí Strong fundamentals across all metrics";
      } else if (finalRisk < 0.7) {
        category = 'medium'; recommendation = 'WATCH';
        output += "\n‚Üí RECOMMENDATION: WATCH\n‚Üí Moderate risk detected\n‚Üí DYOR before investing";
      } else {
        category = 'high'; recommendation = 'AVOID';
        output += "\n‚Üí RECOMMENDATION: AVOID\n‚Üí Multiple red flags detected\n‚Üí Extreme caution advised";
      }
      
      output += `\n‚Üí Risk Score: ${finalRisk.toFixed(2)}/1.00`;
      return { output, risk: parseFloat(finalRisk.toFixed(2)), category, recommendation };
    }
    
    // === MAIN ANALYZE ===
    async function analyzeToken() {
      try {
        console.log('üîç analyzeToken STARTED');
        
        const input = document.getElementById('tokenInput');
        const btn = document.getElementById('analyzeBtn');
        const token = input.value.trim();
        
        if (!token) { alert('Please enter a token'); return; }
        
        btn.disabled = true;
        btn.innerHTML = '<span class="loading-spinner"></span>SCANNING...';
        document.getElementById('verdictSection').style.display = 'none';
        
        ['hunter', 'oracle', 'judge', 'moderator'].forEach(id => {
          const status = document.getElementById(`${id}-status`);
          const output = document.getElementById(`${id}-output`);
          if (status) { status.textContent = 'ANALYZING...'; status.classList.add('analyzing'); }
          if (output) output.innerHTML = '<li>Working...</li>';
        });
        
        console.log('üì° Fetching data...');
        const { offlineMode, tokenData } = await fetchTokenData(token);
        console.log('üì° API response:', offlineMode ? 'OFFLINE' : 'DATA RECEIVED');
        
        console.log('ü§ñ Running agents...');
        const [onChain, sentiment, price] = await Promise.all([
          Promise.resolve(analyzeOnChain(token, tokenData, offlineMode)),
          Promise.resolve(analyzeSentiment(token, tokenData, offlineMode)),
          Promise.resolve(analyzePrice(token, tokenData, offlineMode))
        ]);
        
        console.log('‚úÖ Agents complete:', { onChain: onChain.risk, sentiment: sentiment.risk, price: price.risk });
        
        const hunterOutput = document.getElementById('hunter-output');
        const oracleOutput = document.getElementById('oracle-output');
        const judgeOutput = document.getElementById('judge-output');
        
        if (hunterOutput) hunterOutput.innerHTML = onChain.output.split('\n').filter(l => l.trim()).map(l => `<li>${escapeHTML(l)}</li>`).join('');
        if (oracleOutput) oracleOutput.innerHTML = sentiment.output.split('\n').filter(l => l.trim()).map(l => `<li>${escapeHTML(l)}</li>`).join('');
        if (judgeOutput) judgeOutput.innerHTML = price.output.split('\n').filter(l => l.trim()).map(l => `<li>${escapeHTML(l)}</li>`).join('');
        
        ['hunter', 'oracle', 'judge'].forEach(id => {
          const status = document.getElementById(`${id}-status`);
          if (status) { status.textContent = 'COMPLETE'; status.classList.remove('analyzing'); }
        });
        
        console.log('‚öñÔ∏è Moderator calculating...');
        const moderator = analyzeDiscrepancies(onChain, sentiment, price);
        const modOutput = document.getElementById('moderator-output');
        const modStatus = document.getElementById('moderator-status');
        
        if (modOutput) modOutput.innerHTML = moderator.output.split('\n').filter(l => l.trim()).map(l => `<li>${escapeHTML(l)}</li>`).join('');
        if (modStatus) { modStatus.textContent = 'COMPLETE'; modStatus.classList.remove('analyzing'); }
        
        console.log('‚úÖ Verdict:', moderator.risk, moderator.category);
        
        showVerdict(moderator, token, tokenData);
        
      } catch(error) {
        console.error('‚ùå Analysis failed:', error);
        alert('Analysis failed. Please try again.');
      } finally {
        const btn = document.getElementById('analyzeBtn');
        if (btn) {
          btn.disabled = false;
          btn.innerHTML = 'üîç ANALYZE';
        }
      }
    }
    
    function quickAnalyze(token) {
      document.getElementById('tokenInput').value = token;
      analyzeToken();
    }
    
    function showVerdict(moderator, token, tokenData) {
      // FIXED: STOP WHEELS WHEN VERDICT IS REVEALED
      document.body.classList.add('verdict-revealed');
      
      const section = document.getElementById('verdictSection');
      const scoreEl = document.getElementById('verdictScore');
      const labelEl = document.getElementById('verdictLabel');
      const detailsEl = document.getElementById('verdictDetails');
      
      if (!section || !scoreEl || !labelEl) return;
      
      section.style.display = 'block';
      const { risk, category, recommendation } = moderator;
      
      section.className = `verdict-section ${category === 'high' ? 'high-risk' : 'low-risk'}`;
      scoreEl.className = `verdict-score ${category === 'high' ? 'high-risk' : 'low-risk'}`;
      labelEl.className = `verdict-label ${category === 'high' ? 'high-risk' : 'low-risk'}`;
      
      if (typeof gsap !== 'undefined') {
        const data = { val: 0 };
        gsap.to(data, { val: risk, duration: 2, ease: 'power2.out', onUpdate: function() { scoreEl.textContent = data.val.toFixed(2); }});
      } else {
        scoreEl.textContent = risk.toFixed(2);
      }
      
      labelEl.textContent = category === 'trusted' ? 'TRUSTED' : (category === 'high' ? 'HIGH RISK' : 'LOW RISK');
      
      const tier = localStorage.getItem('selectedTier') || '';
      const isPremium = ['Premium', 'Pro'].includes(tier);
      
      if (isPremium && tokenData && tokenData.baseToken) {
        const contract = tokenData.baseToken.address;
        const chain = tokenData.chainId || 'base';
        
        if (contract && detailsEl) {
          fetch('https://cryptobros-backend.onrender.com/api/goplus/token-security', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ chain_id: chain, contract_addresses: contract })
          })
          .then(res => res.json())
          .then(data => {
            const sec = data.result?.[contract];
            if (sec) {
              let scan = '\nüîç QUANTUM CONTRACT SCAN\n';
              scan += `‚Üí Ownership: ${sec.is_open_source === '1' ? 'RENOUNCED' : 'ACTIVE (CRITICAL RISK)'}\n`;
              scan += `‚Üí Taxes: Buy ${sec.buy_tax || '0'}% | Sell ${sec.sell_tax || '0'}%\n`;
              scan += `‚Üí Liquidity: ${sec.is_proxy === '0' ? 'LOCKED' : 'UNLOCKED (RUG RISK)'}\n`;
              scan += `‚Üí Honeypot: ${sec.is_honeypot === '1' ? 'DETECTED' : 'CLEAR'}\n`;
              scan += `‚Üí Ownership Recovery: ${sec.can_take_back_ownership === '1' ? 'ENABLED (DANGER)' : 'DISABLED'}\n`;
              scan += `‚Üí Anti-Whale: ${sec.is_anti_whale === '1' ? 'ACTIVE' : 'INACTIVE'}`;
              detailsEl.innerHTML = `<pre style="color:#00ff9d">${escapeHTML(scan)}</pre>`;
            }
          })
          .catch(() => { 
            if (detailsEl) detailsEl.innerHTML = '<pre style="color:#ff4d4d">‚ö†Ô∏è Quantum scan unavailable</pre>'; 
          });
        }
      }
    }
    
    function saveVerdict() {
      try {
        const token = document.getElementById('tokenInput').value.trim();
        const risk = document.getElementById('verdictScore').textContent;
        const label = document.getElementById('verdictLabel').textContent;
        
        const verdict = { token, risk, label, timestamp: Date.now() };
        let history = [];
        
        try {
          history = JSON.parse(localStorage.getItem('verdictHistory') || '[]');
        } catch(e) {
          history = [];
          console.warn('Failed to read localStorage');
        }
        
        history.unshift(verdict);
        
        try {
          localStorage.setItem('verdictHistory', JSON.stringify(history.slice(0, 50)));
        } catch(e) {
          console.warn('Failed to save to localStorage');
        }
        
        const btn = document.querySelector('.save-verdict-btn');
        if (btn) {
          btn.textContent = '‚úì SAVED';
          setTimeout(() => { btn.textContent = 'üíæ SAVE VERDICT'; }, 2000);
        }
      } catch(e) {
        console.error('Save failed:', e);
        alert('Failed to save verdict');
      }
    }
    
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => {
        if (typeof tsParticles !== 'undefined') {
          tsParticles.domItem(0)?.refresh();
        }
      }, 250);
    });
    
    window.addEventListener('DOMContentLoaded', () => {
      console.log('üöÄ Tribunal initializing...');
      
      if (isDayMode) {
        document.body.classList.add('day-mode');
        document.getElementById('themeToggle').textContent = '‚òÄÔ∏è';
      }
      if (soundsEnabled) {
        document.getElementById('soundToggle').textContent = 'üîä';
      }
      
      initParticles();
      
      document.getElementById('tokenInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') analyzeToken();
      });
      
      if (typeof VanillaTilt !== 'undefined') {
        VanillaTilt.init(document.querySelectorAll('.agent-card'), { max: 8, speed: 400, glare: true, 'max-glare': 0.3 });
      }
      
      console.log('‚úÖ Tribunal ready');
    });
  </script>
</body>
</html>
