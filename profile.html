<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>CRYPTOBROS</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-size: cover;
      background-attachment: fixed;
      transition: background-image 0.3s;
    }
    .header-container {
      position: relative;
      height: 300px;
      margin-bottom: 60px;
      cursor: move;
      overflow: hidden;
      border: 2px dashed #555;
      border-radius: 8px;
    }
    .header {
      width: 100%;
      height: 100%;
      background-repeat: no-repeat;
      background-size: auto;
      background-position: center;
    }
    .avatar {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      border: 4px solid white;
      background: center/cover;
      position: absolute;
      bottom: -100px;
      left: 50%;
      transform: translateX(-50%);
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      cursor: pointer;
    }
    .edit-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 32px;
      height: 32px;
      background: #333;
      border: 1px solid #666;
      border-radius: 50%;
      color: #ffcc00;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 100;
    }
    .edit-tooltip {
      position: absolute;
      top: 50px;
      right: 16px;
      background: #000;
      color: #ffcc00;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 14px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }
    .edit-menu {
      position: absolute;
      top: 50px;
      right: 16px;
      background: #000;
      border: 1px solid #ffcc00;
      border-radius: 6px;
      padding: 10px;
      display: none;
      z-index: 100;
      min-width: 180px;
    }
    .edit-menu button, .edit-menu select {
      width: 100%;
      margin: 4px 0;
      padding: 6px;
      background: #222;
      color: #ffcc00;
      border: 1px solid #555;
      border-radius: 4px;
      text-align: left;
    }
    .wrapper {
      position: relative;
      top: -20px;
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      gap: 20px;
      padding: 0 20px;
    }
    .sidebar { width: 200px; }
    .nav-item {
      padding: 10px 0;
      color: #385898;
      font-weight: bold;
      cursor: pointer;
    }
    .main { flex: 1; }
    .name, .rank, .field-value {
      color: #ffcc00;
      animation: flicker 3s infinite alternate;
    }
    @keyframes flicker {
      0%, 19%, 21%, 23%, 25%, 54%, 56%, 80%, 82%, 84%, 86%, 100% { opacity: 1; }
      20%, 24%, 55%, 81%, 85% { opacity: 0.8; }
    }
    .name {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 8px;
    }
    .rank {
      margin-bottom: 20px;
    }
    .field-label {
      color: #aaa;
      margin: 10px 0 4px;
      font-weight: bold;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin: 5px 0 15px;
      background: rgba(0,0,0,0.3);
      color: #ffcc00;
      border: 1px solid #555;
      border-radius: 4px;
    }
    .btn {
      background: #4267B2;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
    }
    #header-upload, #avatar-upload, #bg-upload { display: none; }
  </style>
</head>
<body>

<div class="header-container" id="headerContainer">
  <div class="header" id="header"></div>
</div>

<div class="avatar" id="avatar"></div>

<div class="edit-btn" id="editBtn">⚙️</div>
<div class="edit-tooltip" id="editTooltip">Редактировать профиль</div>
<div class="edit-menu" id="editMenu"></div>

<div class="wrapper">
  <div class="sidebar">
    <div class="nav-item">News Feed</div>
    <div class="nav-item">Messages</div>
    <div class="nav-item">My Groups</div>
    <div class="nav-item">Tribunal</div>
    <div class="nav-item">Мои друзья</div>
  </div>

  <div class="main" id="profileContent"></div>
</div>

<input type="file" id="header-upload" accept="image/*">
<input type="file" id="avatar-upload" accept="image/*">
<input type="file" id="bg-upload" accept="image/*">

<script>
  let profileData = JSON.parse(localStorage.getItem('profileData')) || { name: '', about: '', city: '' };
  let headerPos = JSON.parse(localStorage.getItem('headerPos')) || { x: 0, y: 0 };
  let currentBg = localStorage.getItem('pageBg') || 'bg3.jpg';
  let customBg = localStorage.getItem('customBg'); // base64

  function applyBackground() {
    if (customBg) {
      document.body.style.backgroundImage = `url(${customBg})`;
    } else {
      document.body.style.backgroundImage = `url('https://raw.githubusercontent.com/SolPhantomX/cryptobros/main/${currentBg}')`;
    }
  }

  function init() {
    const headerImg = localStorage.getItem('header') || 'https://raw.githubusercontent.com/SolPhantomX/cryptobros/main/header.jpg';
    const avatarImg = localStorage.getItem('avatar') || 'https://raw.githubusercontent.com/SolPhantomX/cryptobros/main/avatar.png';
    
    document.getElementById('header').style.backgroundImage = `url(${headerImg})`;
    document.getElementById('avatar').style.backgroundImage = `url(${avatarImg})`;
    document.getElementById('header').style.backgroundPosition = `${headerPos.x}px ${headerPos.y}px`;
    
    applyBackground();
    renderViewMode();
    buildMenu();
  }

  function renderViewMode() {
    const el = document.getElementById('profileContent');
    el.innerHTML = `
      <div class="name">@cryptobros</div>
      <div class="rank">Degen (Master)</div>
      ${profileData.name ? `<div class="field-label">Full Name</div><div class="field-value">${profileData.name}</div>` : ''}
      ${profileData.about ? `<div class="field-label">About</div><div class="field-value">${profileData.about}</div>` : ''}
      ${profileData.city ? `<div class="field-label">City</div><div class="field-value">${profileData.city}</div>` : ''}
    `;
  }

  function renderEditMode() {
    const el = document.getElementById('profileContent');
    el.innerHTML = `
      <div class="name">@cryptobros</div>
      <div class="rank">Degen (Master)</div>
      <div class="field-label">Full Name</div>
      <input type="text" id="inpName" value="${profileData.name}" placeholder="Enter your name">
      <div class="field-label">About</div>
      <textarea id="inpAbout" placeholder="Tell us about yourself...">${profileData.about}</textarea>
      <div class="field-label">City</div>
      <input type="text" id="inpCity" value="${profileData.city}" placeholder="Your city">
      <button class="btn" onclick="saveProfile()">SAVE PROFILE</button>
    `;
  }

  function saveProfile() {
    profileData = {
      name: document.getElementById('inpName').value,
      about: document.getElementById('inpAbout').value,
      city: document.getElementById('inpCity').value
    };
    localStorage.setItem('profileData', JSON.stringify(profileData));
    renderViewMode();
  }

  // Drag-to-pan
  let isDragging = false;
  document.getElementById('headerContainer').addEventListener('mousedown', e => {
    isDragging = true;
    startX = e.clientX - headerPos.x;
    startY = e.clientY - headerPos.y;
    document.body.style.cursor = 'grabbing';
  });
  document.addEventListener('mousemove', e => {
    if (!isDragging) return;
    headerPos.x = e.clientX - startX;
    headerPos.y = e.clientY - startY;
    document.getElementById('header').style.backgroundPosition = `${headerPos.x}px ${headerPos.y}px`;
  });
  document.addEventListener('mouseup', () => {
    if (isDragging) {
      isDragging = false;
      document.body.style.cursor = 'default';
      localStorage.setItem('headerPos', JSON.stringify(headerPos));
    }
  });

  // Аплоады
  document.getElementById('header-upload').addEventListener('change', e => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = ev => {
        document.getElementById('header').style.backgroundImage = `url(${ev.target.result})`;
        localStorage.setItem('header', ev.target.result);
        headerPos = { x: 0, y: 0 };
        localStorage.setItem('headerPos', JSON.stringify(headerPos));
        document.getElementById('header').style.backgroundPosition = '0px 0px';
      };
      reader.readAsDataURL(file);
    }
  });

  document.getElementById('avatar-upload').addEventListener('change', e => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = ev => {
        document.getElementById('avatar').style.backgroundImage = `url(${ev.target.result})`;
        localStorage.setItem('avatar', ev.target.result);
      };
      reader.readAsDataURL(file);
    }
  });

  // Аплоад фона
  document.getElementById('bg-upload').addEventListener('change', e => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = ev => {
        customBg = ev.target.result;
        localStorage.setItem('customBg', customBg);
        localStorage.removeItem('pageBg'); // отключаем предустановленный
        applyBackground();
        buildMenu();
      };
      reader.readAsDataURL(file);
    }
  });

  // Клик по элементам
  document.getElementById('headerContainer').onclick = () => document.getElementById('header-upload').click();
  document.getElementById('avatar').onclick = () => document.getElementById('avatar-upload').click();

  // Меню
  function buildMenu() {
    const menu = document.getElementById('editMenu');
    let options = '';
    for (let i = 1; i <= 13; i++) {
      const name = ['Neural Core','Cyber Grid','Dark Void','Quantum Flow','Matrix','Solana Nexus','AI Tribunal','Crypto Void','Phantom Glow','DeFi Circuit','Token Storm','Web3 Horizon','Degen Realm'][i-1];
      const selected = (currentBg === `bg${i}.jpg` && !customBg) ? ' style="color:#00ff9d;"' : '';
      options += `<button onclick="setBg('bg${i}.jpg')"${selected}>${name}</button>`;
    }
    options += `<button onclick="document.getElementById('bg-upload').click()">+ Загрузить свой фон</button>`;
    menu.innerHTML = `
      <button onclick="toggleEdit()">Редактировать профиль</button>
      <div style="margin:6px 0;color:#666;font-size:12px;">Фон страницы:</div>
      ${options}
    `;
  }

  function setBg(bg) {
    currentBg = bg;
    customBg = null;
    localStorage.setItem('pageBg', bg);
    localStorage.removeItem('customBg');
    applyBackground();
    document.getElementById('editMenu').style.display = 'none';
    buildMenu();
  }

  function toggleEdit() {
    document.getElementById('editMenu').style.display = 'none';
    renderEditMode();
  }

  // Шестерёнка
  const editBtn = document.getElementById('editBtn');
  const tooltip = document.getElementById('editTooltip');
  const menu = document.getElementById('editMenu');

  editBtn.onmouseenter = () => tooltip.style.opacity = '1';
  editBtn.onmouseleave = () => tooltip.style.opacity = '0';
  editBtn.onclick = () => {
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
  };

  document.addEventListener('click', e => {
    if (!editBtn.contains(e.target) && !menu.contains(e.target)) {
      menu.style.display = 'none';
    }
  });

  window.onload = init;
</script>

</body>
</html>
