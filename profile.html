<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>CRYPTOBROS</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: Arial, sans-serif;
      background-size: cover;
      background-attachment: fixed;
    }
    .top-section {
      position: relative;
      height: 300px;
    }
    .header {
      width: 100%;
      height: 100%;
      background: center/cover;
      border: 2px dashed #555;
      border-radius: 8px;
      cursor: pointer;
    }
    .header.loaded {
      border: none;
    }
    .avatar {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      border: 4px solid white;
      background: center/cover;
      position: absolute;
      bottom: -100px;
      left: 50%;
      transform: translateX(-50%);
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      cursor: pointer;
    }
    .main-layout {
      max-width: 1200px;
      margin: 220px auto 0;
      display: flex;
      gap: 20px;
      padding: 0 20px;
    }
    .edit-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 32px;
      height: 32px;
      background: #333;
      border: 1px solid #666;
      border-radius: 50%;
      color: #ffcc00;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 100;
    }
    .edit-tooltip {
      position: absolute;
      top: 50px;
      right: 16px;
      background: #000;
      color: #ffcc00;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 14px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      z-index: 100;
    }
    .edit-menu {
      position: absolute;
      top: 50px;
      right: 16px;
      background: #000;
      border: 1px solid #ffcc00;
      border-radius: 6px;
      padding: 8px;
      display: none;
      z-index: 100;
      min-width: 180px;
    }
    .edit-menu button {
      background: #222;
      color: #ffcc00;
      border: 1px solid #555;
      border-radius: 4px;
      padding: 4px 8px;
      margin: 2px;
      cursor: pointer;
      font-size: 12px;
      display: inline-block;
      width: 100%;
      text-align: left;
    }
    .sidebar { width: 200px; }
    .nav-item {
      padding: 10px 0;
      color: var(--text-color, #ffcc00);
      font-weight: bold;
      cursor: pointer;
      font-size: 18px;
      animation: flicker 3s infinite alternate;
    }
    .nav-item:hover {
      opacity: 0.8;
      text-shadow: 0 0 8px var(--text-color, #ffcc00);
    }
    a.nav-item {
      text-decoration: none;
      display: block;
    }
    .main { flex: 1; }
    .name, .rank, .field-value, .field-label {
      color: var(--text-color, #ffcc00);
      animation: flicker 3s infinite alternate;
    }
    @keyframes flicker {
      0%,19%,21%,23%,25%,54%,56%,80%,82%,84%,86%,100% { opacity:1; }
      20%,24%,55%,81%,85% { opacity:0.8; }
    }
    .name { font-size: 28px; font-weight: bold; margin-bottom: 8px; }
    .rank { margin-bottom: 20px; }
    .field-label { color: #aaa; margin: 10px 0 4px; font-weight: bold; }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin: 5px 0 15px;
      background: rgba(0,0,0,0.3);
      color: var(--text-color, #ffcc00);
      border: 1px solid #555;
      border-radius: 4px;
    }
    .btn {
      background: #4267B2;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
    }
    #header-upload, #avatar-upload, #bg-upload { display: none; }
  </style>
</head>
<body>
<div class="top-section">
  <div class="header" id="header"></div>
  <div class="avatar" id="avatar"></div>
  <div class="edit-btn" id="editBtn">⚙️</div>
  <div class="edit-tooltip" id="editTooltip">Edit Profile</div>
  <div class="edit-menu" id="editMenu"></div>
</div>
<div class="main-layout">
  <div class="sidebar">
    <div class="nav-item">News Feed</div>
    <div class="nav-item">Messages</div>
    <div class="nav-item">My Groups</div>
    <a href="tribunal.html" class="nav-item">Tribunal</a>
    <div class="nav-item">My Friends</div>
  </div>
  <div class="main" id="profileContent"></div>
</div>
<input type="file" id="header-upload" accept="image/*">
<input type="file" id="avatar-upload" accept="image/*">
<input type="file" id="bg-upload" accept="image/*">
<script>
  let profileData = JSON.parse(localStorage.getItem('profileData')) || { name: '', about: '', city: '' };
  let headerPos = JSON.parse(localStorage.getItem('headerPos')) || { x: 0, y: 0 };
  let isProfileSaved = localStorage.getItem('isProfileSaved') === 'true';
  let textColor = localStorage.getItem('textColor') || '#ffcc00';

  function init() {
    const headerEl = document.getElementById('header');
    const avatarEl = document.getElementById('avatar');

    const headerImg = localStorage.getItem('header') || '';
    const avatarImg = localStorage.getItem('avatar') || '';

    if (headerImg) {
      headerEl.style.backgroundImage = `url(${headerImg})`;
      headerEl.classList.add('loaded');
    }
    if (avatarImg) {
      avatarEl.style.backgroundImage = `url(${avatarImg})`;
    }

    headerEl.style.backgroundPosition = `${headerPos.x}px ${headerPos.y}px`;
    document.documentElement.style.setProperty('--text-color', textColor);

    renderViewMode();
    buildEditMenu();

    setupDragToPan();
  }

  function setupDragToPan() {
    const headerEl = document.getElementById('header');
    if (!headerEl) return;

    let isDragging = false;
    let startX, startY;
    let startXPx, startYPx;

    headerEl.addEventListener('mousedown', e => {
      if (isProfileSaved) return;
      isDragging = true;
      startX = e.clientX;
      startY = e.clientY;

      const bgPos = getComputedStyle(headerEl).backgroundPosition.split(' ');
      startXPx = parseFloat(bgPos[0]) || 0;
      startYPx = parseFloat(bgPos[1]) || 0;

      document.body.style.cursor = 'grabbing';
    });

    document.addEventListener('mousemove', e => {
      if (!isDragging) return;
      const dx = e.clientX - startX;
      const dy = e.clientY - startY;
      headerPos.x = startXPx + dx;
      headerPos.y = startYPx + dy;
      headerEl.style.backgroundPosition = `${headerPos.x}px ${headerPos.y}px`;
    });

    document.addEventListener('mouseup', () => {
      if (isDragging) {
        isDragging = false;
        document.body.style.cursor = 'default';
        if (!isProfileSaved) {
          localStorage.setItem('headerPos', JSON.stringify(headerPos));
        }
      }
    });
  }

  function buildEditMenu() {
    const menu = document.getElementById('editMenu');
    menu.innerHTML = `
      <button onclick="toggleEdit()">Edit Profile</button>
      <button onclick="changeBackground()">Change Background</button>
      <button onclick="chooseTextColor()">Text Color</button>
    `;
  }

  function toggleEdit() {
    document.getElementById('editMenu').style.display = 'none';
    renderEditMode();
    isProfileSaved = false;
    setupDragToPan();
  }

  function changeBackground() {
    document.getElementById('editMenu').style.display = 'none';
    const content = document.getElementById('profileContent');
    let buttons = '';
    for (let i = 1; i <= 13; i++) {
      buttons += `<div style="margin:4px 0;"><button onclick="setBg('bg${i}.jpg')" style="width:100%;text-align:left;">bg${i}.jpg</button></div>`;
    }
    buttons += `<div style="margin:4px 0;"><button onclick="document.getElementById('bg-upload').click()" style="width:100%;text-align:left;">Upload Custom</button></div>`;
    content.innerHTML = `
      <div style="color:var(--text-color);margin-bottom:10px;font-weight:bold;">Select Page Background</div>
      <div>${buttons}</div>
      <button class="btn" style="margin-top:10px;background:#666;" onclick="renderViewMode()">Back</button>
    `;
  }

  function chooseTextColor() {
    document.getElementById('editMenu').style.display = 'none';
    const content = document.getElementById('profileContent');

    const colors = [
      { name: 'Black', hex: '#000000' },
      { name: 'Red', hex: '#FF0000' },
      { name: 'Green', hex: '#00FF00' },
      { name: 'Blue', hex: '#0000FF' },
      { name: 'Yellow', hex: '#FFFF00' },
      { name: 'Magenta', hex: '#FF00FF' },
      { name: 'Cyan', hex: '#00FFFF' },
      { name: 'White', hex: '#FFFFFF' }
    ];

    let colorButtons = '';
    colors.forEach(c => {
      const textContrast = (c.hex === '#000000' || c.hex === '#FFFFFF') ? 
        (c.hex === '#000000' ? '#FFFFFF' : '#000000') : '#FFFFFF';
      colorButtons += `
        <div style="margin:6px 0;">
          <button 
            onclick="setTextColor('${c.hex}')" 
            style="width:100%; font-weight:bold; color:${textContrast}; background:${c.hex}; border:1px solid #555; padding:8px;"
          >${c.name}</button>
        </div>
      `;
    });

    content.innerHTML = `
      <div style="color:var(--text-color);margin-bottom:10px;font-weight:bold;">Choose Text Color</div>
      <div>${colorButtons}</div>
      <button class="btn" style="margin-top:10px;background:#666;" onclick="renderViewMode()">Back</button>
    `;
  }

  function setTextColor(hex) {
    textColor = hex;
    localStorage.setItem('textColor', hex);
    document.documentElement.style.setProperty('--text-color', textColor);
    renderViewMode();
  }

  function setBg(filename) {
    fetch(`https://raw.githubusercontent.com/SolPhantomX/cryptobros/main/${filename}`)
      .then(res => res.blob())
      .then(blob => {
        const reader = new FileReader();
        reader.onload = () => {
          document.body.style.backgroundImage = `url(${reader.result})`;
          localStorage.setItem('pageBg', reader.result);
        };
        reader.readAsDataURL(blob);
      })
      .catch(() => alert(`File ${filename} not found`));
  }

  function renderViewMode() {
    const content = document.getElementById('profileContent');
    content.innerHTML = `
      <div class="name">${profileData.name || '—'}</div>
      <div class="rank">Degen (Master)</div>
      <div class="field-label">About</div>
      <div class="field-value">${profileData.about || '—'}</div>
      <div class="field-label">City</div>
      <div class="field-value">${profileData.city || '—'}</div>
    `;
  }

  function renderEditMode() {
    const content = document.getElementById('profileContent');
    content.innerHTML = `
      <input type="text" id="nameInput" value="${profileData.name}" placeholder="Name" />
      <div class="rank">Degen (Master)</div>
      <div class="field-label">About</div>
      <textarea id="aboutInput" placeholder="About">${profileData.about}</textarea>
      <div class="field-label">City</div>
      <input type="text" id="cityInput" value="${profileData.city}" placeholder="City" />
      <button class="btn" onclick="saveProfile()">Save Profile</button>
      <button class="btn" style="background:#666;margin-left:10px;" onclick="renderViewMode()">Cancel</button>
    `;
  }

  function saveProfile() {
    profileData = {
      name: document.getElementById('nameInput').value,
      about: document.getElementById('aboutInput').value,
      city: document.getElementById('cityInput').value
    };
    localStorage.setItem('profileData', JSON.stringify(profileData));
    localStorage.setItem('isProfileSaved', 'true');
    isProfileSaved = true;
    renderViewMode();
  }

  document.getElementById('header').addEventListener('click', () => {
    document.getElementById('header-upload').click();
  });

  document.getElementById('avatar').addEventListener('click', () => {
    document.getElementById('avatar-upload').click();
  });

  document.getElementById('header-upload').addEventListener('change', e => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = () => {
        document.getElementById('header').style.backgroundImage = `url(${reader.result})`;
        document.getElementById('header').classList.add('loaded');
        localStorage.setItem('header', reader.result);
        if (!isProfileSaved) {
          document.getElementById('header').style.backgroundPosition = `${headerPos.x}px ${headerPos.y}px`;
        }
      };
      reader.readAsDataURL(file);
    }
  });

  document.getElementById('avatar-upload').addEventListener('change', e => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = () => {
        document.getElementById('avatar').style.backgroundImage = `url(${reader.result})`;
        localStorage.setItem('avatar', reader.result);
      };
      reader.readAsDataURL(file);
    }
  });

  document.getElementById('bg-upload').addEventListener('change', e => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = () => {
        document.body.style.backgroundImage = `url(${reader.result})`;
        localStorage.setItem('pageBg', reader.result);
      };
      reader.readAsDataURL(file);
    }
  });

  document.getElementById('editBtn').addEventListener('click', () => {
    const menu = document.getElementById('editMenu');
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
  });

  document.addEventListener('click', e => {
    const btn = document.getElementById('editBtn');
    const menu = document.getElementById('editMenu');
    if (!btn.contains(e.target) && !menu.contains(e.target)) {
      menu.style.display = 'none';
    }
  });

  window.toggleEdit = toggleEdit;
  window.changeBackground = changeBackground;
  window.chooseTextColor = chooseTextColor;
  window.setTextColor = setTextColor;
  window.renderViewMode = renderViewMode;
  window.saveProfile = saveProfile;

  init();
</script>
</body>
</html>
